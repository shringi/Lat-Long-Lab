<!DOCTYPE html>
<html lang="en" class="h-full">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lat-Long Lab</title>
    <link rel="icon" href="icons/favicon.ico">

    <!-- =========================================================================
         Global Error Handler (Catch-all for early startup errors)
         ========================================================================= -->
    <script>
        window.onerror = function (msg, url, line, col, error) {
            // Ignore benign ResizeObserver loop errors
            if (msg && msg.toString().includes('ResizeObserver')) {
                return true; // Suppress error
            }

            var extra = !col ? '' : '\ncolumn: ' + col;
            extra += !error ? '' : '\nerror: ' + error;
            console.error("Error: " + msg + "\nurl: " + url + "\nline: " + line + extra);

            var errorDiv = document.createElement("div");
            Object.assign(errorDiv.style, {
                position: "fixed", top: "0", left: "0", width: "100%",
                backgroundColor: "#ef4444", color: "white", zIndex: "999999",
                padding: "1rem", fontFamily: "monospace", fontSize: "0.875rem",
                boxShadow: "0 4px 6px -1px rgba(0, 0, 0, 0.1)"
            });
            errorDiv.innerText = "CRITICAL ERROR: " + msg + " at " + line;
            document.body.appendChild(errorDiv);
            return false;
        };
        console.log("Global error handler registered");
    </script>

    <!-- =========================================================================
         Stylesheets & CDN Resources
         ========================================================================= -->

    <!-- Core UI Framework (Tailwind CSS) - Replaced by local build -->

    <!-- Mapping Library (Leaflet) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />

    <!-- DataTables & Plugins -->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.3.5/css/dataTables.dataTables.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/columncontrol/1.1.1/css/columnControl.dataTables.css">

    <!-- Application Styles -->
    <link rel="stylesheet" href="style.css">

    <!-- Core Dependencies (Pre-load) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>

<body class="h-full flex flex-col sm:flex-row overflow-hidden relative font-sans text-gray-900">

    <!-- =========================================================================
         1. Loading Overlay
         ========================================================================= -->
    <div id="loadingOverlay"
        class="fixed inset-0 bg-white z-[99999] flex flex-col items-center justify-center transition-opacity duration-500">
        <img src="icons/loading_icon.png" alt="Loading..." class="w-16 h-16 animate-pulse mb-4">
        <p class="text-gray-500 text-sm font-medium">Initializing Lat-Long Lab...</p>
    </div>

    <!-- =========================================================================
         2. Sidebar / Controls Panel
         ========================================================================= -->
    <aside id="sidebar"
        class="w-full sm:w-96 bg-white shadow-xl z-20 flex flex-col h-1/2 sm:h-full border-r border-gray-200 sm:flex-none transition-all duration-300 transform">

        <!-- App Header -->
        <div
            class="p-6 border-b border-gray-100 bg-gradient-to-r from-blue-600 to-indigo-700 text-white flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <img src="icons/logo_192.png" alt="Logo"
                    class="w-10 h-10 bg-white rounded-lg p-1 shadow-sm flex-shrink-0">
                <div>
                    <h1 class="text-2xl font-bold tracking-tight leading-none">Lat-Long Lab</h1>
                    <p class="text-xs mt-1 opacity-70">A Lat-Long Explorer Tool</p>
                </div>
            </div>
            <!-- Collapse Button -->
            <button id="collapseSidebarBtn"
                class="text-white hover:text-gray-200 focus:outline-none p-1 rounded hover:bg-white/10 transition-colors"
                title="Collapse Sidebar">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
        </div>

        <!-- Navigation Tabs -->
        <div id="tabContainer" class="flex border-b border-gray-200 transition-all duration-300">
            <button id="tabInput"
                class="flex-1 py-3 text-sm font-medium text-blue-600 border-b-2 border-blue-600 focus:outline-none transition-colors flex items-center justify-center space-x-2 group"
                title="Input">
                <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                </svg>
                <span class="tab-text">Input</span>
            </button>
            <button id="tabProcess"
                class="flex-1 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 focus:outline-none transition-colors flex items-center justify-center space-x-2 group"
                title="Process">
                <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z">
                    </path>
                </svg>
                <span class="tab-text">Process</span>
            </button>
            <button id="tabExport"
                class="flex-1 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 focus:outline-none transition-colors flex items-center justify-center space-x-2 group"
                title="Export Data">
                <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                </svg>
                <span class="tab-text">Export</span>
            </button>
        </div>

        <!-- Input Content -->
        <div id="contentInput" class="flex-1 overflow-y-auto p-4 space-y-4">
            <!-- File Upload Area -->
            <div
                class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 hover:bg-blue-50 transition-colors cursor-pointer group relative">
                <input id="csvFile" type="file" accept=".csv,.tsv,.txt,.xlsx,.xls"
                    class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />
                <div class="space-y-2 pointer-events-none">
                    <svg class="mx-auto h-10 w-10 text-gray-400 group-hover:text-blue-500 transition-colors" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12">
                        </path>
                    </svg>
                    <p class="text-sm text-gray-500 group-hover:text-blue-600"><span class="font-semibold">Click to
                            upload</span> or drag and drop</p>
                    <p class="text-xs text-gray-400">(CSV, Excel, TXT)</p>
                </div>
            </div>

            <!-- Divider -->
            <div class="relative">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-gray-200"></div>
                </div>
                <div class="relative flex justify-center text-sm"><span class="px-2 bg-white text-gray-500">OR</span>
                </div>
            </div>

            <!-- URL Input -->
            <div class="flex space-x-2">
                <input type="text" id="urlInput" placeholder="Paste URL (CSV/JSON)..."
                    class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border bg-gray-50 text-xs">
                <button id="urlBtn"
                    class="px-3 py-2 border border-transparent rounded-md shadow-sm text-xs font-medium text-white bg-gray-600 hover:bg-gray-700 focus:outline-none transition-colors">Fetch</button>
            </div>

            <!-- Divider -->
            <div class="relative">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-gray-200"></div>
                </div>
                <div class="relative flex justify-center text-sm"><span class="px-2 bg-white text-gray-500">OR</span>
                </div>
            </div>

            <!-- Paste Area -->
            <div>
                <textarea id="csvInput" rows="3"
                    class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-3 border bg-gray-50 font-mono text-xs"
                    placeholder="Paste data here..."></textarea>
            </div>

            <button id="loadBtn"
                class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                Load Pasted Data
            </button>

            <!-- Divider -->
            <div class="relative">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-gray-200"></div>
                </div>
                <div class="relative flex justify-center text-sm"><span class="px-2 bg-white text-gray-500">OR</span>
                </div>
            </div>

            <!-- Sample Data Button -->
            <button id="sampleBtn"
                class="w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                Load Sample Data (Cities)
            </button>

            <!-- Status Indicator -->
            <div id="dataStats" class="hidden text-xs text-gray-500 text-center bg-gray-100 p-2 rounded">
                Loaded <span id="pointCount" class="font-bold text-gray-800">0</span> points.
            </div>
        </div>
        </div>
        </div>

        <!-- Process Content -->
        <div id="contentProcess" class="hidden flex-1 overflow-y-auto p-4 space-y-6">
            <!-- 1. FILTER CARD -->
            <div id="selectionSection"
                class="bg-white border boundary-gray-200 rounded-lg p-4 shadow-sm space-y-4 transition-opacity duration-300 opacity-50 pointer-events-none">
                <h2 class="text-sm uppercase tracking-wider text-gray-500 font-semibold flex items-center space-x-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z">
                        </path>
                    </svg>
                    <span>Filter Data</span>
                </h2>

                <!-- Toggle -->
                <div class="flex items-center justify-between">
                    <span class="text-xs text-gray-600">Filter by Map Selection (Rectangle)</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="filterToggle" class="sr-only peer">
                        <div
                            class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600">
                        </div>
                    </label>
                </div>

                <!-- Stats -->
                <div class="bg-blue-50 border-l-4 border-blue-500 p-3 rounded-r text-xs">
                    <p class="text-blue-700">Selected: <span id="selectedCount" class="font-bold">0</span> points
                    </p>
                </div>
            </div>

            <!-- 2. ENRICHMENT CARD -->
            <div id="enrichmentSection" class="bg-white border boundary-gray-200 rounded-lg p-4 shadow-sm space-y-4">
                <h2 class="text-sm uppercase tracking-wider text-gray-500 font-semibold flex items-center space-x-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z">
                        </path>
                    </svg>
                    <span>Enrich Data</span>
                </h2>

                <div class="grid grid-cols-1 gap-3">
                    <!-- Country Button -->
                    <button id="enrichBtn" disabled
                        class="group relative flex items-center w-full p-3 text-left border rounded-lg hover:border-blue-500 hover:shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:border-gray-200">
                        <div
                            class="flex-shrink-0 p-2 bg-green-100 text-green-600 rounded-md group-hover:bg-green-600 group-hover:text-white transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                </path>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-900">Add Country Column</p>
                            <p class="text-xs text-gray-500">Spatial join with world borders.</p>
                        </div>
                    </button>

                    <!-- UTM Button -->
                    <button id="enrichUtmBtn" disabled
                        class="group relative flex items-center w-full p-3 text-left border rounded-lg hover:border-blue-500 hover:shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:border-gray-200">
                        <div
                            class="flex-shrink-0 p-2 bg-purple-100 text-purple-600 rounded-md group-hover:bg-purple-600 group-hover:text-white transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7">
                                </path>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-900">Add UTM Coordinates</p>
                            <p class="text-xs text-gray-500">Convert Lat/Lon to Easting/Northing.</p>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Export Content -->
        <div id="contentExport" class="hidden flex-1 overflow-y-auto p-4 space-y-6">
            <div id="exportSection" class="bg-white border boundary-gray-200 rounded-lg p-4 shadow-sm space-y-4">
                <h2 class="text-sm uppercase tracking-wider text-gray-500 font-semibold flex items-center space-x-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                    <span>Export Data</span>
                </h2>
                <div class="space-y-4">
                    <p class="text-sm text-gray-600">Download the enriched dataset as a CSV file. The file will include
                        all original columns plus any new columns added during processing (e.g., Country, UTM Zone).</p>
                    <button id="exportBtn"
                        class="w-full flex justify-center items-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                        Download Result CSV
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div id="sidebarFooter"
            class="p-4 border-t border-gray-200 bg-gray-50 flex items-center justify-between text-xs text-gray-500">
            <a href="https://github.com/shringi/Lat-Long-Lab" target="_blank"
                class="footer-link flex items-center space-x-1 hover:text-blue-600 transition-colors"
                title="View on GitHub">
                <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                    <path
                        d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                </svg>
                <span class="footer-text">View on GitHub</span>
            </a>
            <span class="footer-version bg-gray-200 px-1.5 py-0.5 rounded text-[10px] font-mono">v1.4.1</span>
        </div>
    </aside>

    <!-- =========================================================================
         3. Main Content (Map & Table)
         ========================================================================= -->
    <main id="mainContent" class="flex-1 relative h-full flex flex-col">

        <!-- Sidebar Toggle (Visible when collapsed) -->


        <!-- Unified View Mode Controller -->
        <div id="viewModeControls"
            class="absolute top-4 left-1/2 transform -translate-x-1/2 z-[9999] bg-white rounded-md shadow-md p-1 flex space-x-1 border border-gray-300">
            <!-- Full Map -->
            <button data-mode="map" class="p-2 rounded hover:bg-gray-100 text-gray-600 active-mode"
                title="Full Map View">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                    </path>
                </svg>
            </button>
            <!-- Split View -->
            <button data-mode="split" class="p-2 rounded hover:bg-gray-100 text-gray-600" title="Split View">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <!-- Half filled rect -->
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7">
                    </path>
                    <rect x="4" y="14" width="8" height="6" stroke="currentColor" stroke-width="2" fill="none"></rect>
                </svg>
            </button>
            <!-- Full Table -->
            <button data-mode="table" class="p-2 rounded hover:bg-gray-100 text-gray-600" title="Full Table View">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z">
                    </path>
                </svg>
            </button>
        </div>

        <!-- Map View -->
        <div id="mapContainer" class="flex-1 relative w-full h-full transition-all duration-300">
            <div id="map" class="absolute inset-0 z-0"></div>
            <!-- Mobile Toggle -->
            <button id="showTableBtn"
                class="absolute bottom-6 right-4 z-[1000] bg-blue-600 text-white px-4 py-2 rounded-full shadow-lg hover:bg-blue-700 transition-colors font-medium text-sm hidden">
                Show Data Table
            </button>
        </div>

        <!-- Table View -->
        <div id="tableContainer"
            class="hidden bg-white flex flex-col transition-all duration-300 border-t border-gray-200 relative">
            <div class="flex justify-between items-center p-2 bg-gray-50 border-b border-gray-200">
                <h2 class="text-sm font-bold text-gray-700">Data View</h2>
                <div class="flex space-x-2">
                    <button id="downloadTableBtn"
                        class="text-xs bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded text-gray-700">Export
                        CSV</button>
                    <button id="closeTableBtn" class="text-gray-500 hover:text-gray-700 hidden">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div id="dataTableContainer" class="flex-1 w-full text-xs overflow-auto p-2">
                <table id="dataTable" class="display w-full" style="width:100%">
                    <thead></thead>
                    <tfoot></tfoot>
                </table>
            </div>
        </div>
    </main>

    <!-- =========================================================================
         4. Modals & Overlays
         ========================================================================= -->

    <!-- Column Mapping Modal -->
    <div id="columnMappingModal" class="absolute inset-0 bg-black/50 z-[10000] hidden flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 w-96 max-w-full m-4">
            <h3 class="text-lg font-bold text-gray-900 mb-4">Map Columns</h3>
            <p class="text-sm text-gray-600 mb-4">Please select the columns that contain the coordinates.</p>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Latitude Column</label>
                    <select id="latColSelect"
                        class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border"></select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Longitude Column</label>
                    <select id="lngColSelect"
                        class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border"></select>
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancelMappingBtn"
                    class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">Cancel</button>
                <button id="confirmMappingBtn"
                    class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md">Map
                    Columns</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <!-- Debug Console -->
    <div id="debugConsole"
        class="fixed bottom-0 left-0 w-full h-48 bg-gray-900 text-green-400 font-mono text-xs z-[20000] hidden flex flex-col border-t-2 border-gray-700 transition-all duration-300">
        <div class="flex justify-between items-center bg-gray-800 px-4 py-1 border-b border-gray-700 select-none">
            <span class="font-bold text-gray-300">Debug Console</span>
            <div class="flex space-x-2">
                <button id="copyLogsBtn" class="hover:text-white text-gray-400" title="Copy Logs">üìã</button>
                <button id="clearLogsBtn" class="hover:text-white text-gray-400" title="Clear Logs">üö´</button>
                <button id="closeDebugBtn" class="hover:text-white text-gray-400" title="Minimize">‚¨áÔ∏è</button>
            </div>
        </div>
        <div id="debugOutput" class="flex-1 overflow-y-auto p-2 space-y-1"></div>
    </div>

    <!-- Floating Debug Button -->
    <button id="showDebugBtn"
        class="fixed bottom-4 right-4 z-[99999] bg-gray-800 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 opacity-50 hover:opacity-100 hover:scale-110"
        title="Show Debug Console">
        üêû
    </button>

    <!-- =========================================================================
         5. Scripts (Load Order: Libs -> Data -> Core -> Feature -> Main)
         ========================================================================= -->



    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="https://unpkg.com/leaflet-providers@1.13.0/leaflet-providers.js"></script>
    <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
    <script src="https://cdn.datatables.net/2.3.5/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/columncontrol/1.1.1/js/dataTables.columnControl.js"></script>

    <!-- Data Assets -->


    <!-- App Core -->
    <script type="module" src="/js/core/state.js"></script>
    <script type="module" src="/js/core/debug.js"></script>

    <!-- App Modules -->
    <script type="module" src="/js/modules/ui.js"></script>
    <script type="module" src="/js/modules/map.js"></script>
    <script type="module" src="/js/modules/table.js"></script>
    <script type="module" src="/js/modules/data.js"></script>

    <!-- Entry Point -->
    <script type="module" src="/js/main.js"></script>
</body>

</html>